<div class='row justify-content-center'>
    <div class='col-10 col-md-6'>
        <div id="carouselExampleControls" class="carousel slide mb-3" data-bs-ride="carousel">
            {{!-- <div class="carousel-indicators">
                {{#each spot.images}}
                    <button type="button" data-bs-target="#carouselExampleControls" data-bs-slide-to="{{@index}}" class="" aria-current="{{#ifEquals @index 0 }}true{{/ifEquals}}" aria-label="Slide {{inc @index}}"></button>
                {{/each}}
            </div> --}}
            <div class="carousel-inner">
                {{#each spot.images}}
                        <div class="carousel-item {{#ifEquals @index 0 }}active{{/ifEquals}}">
                            <img src='{{ url }}' alt='Image of {{ spot.name }}' class="d-block w-100">
                        </div>
                    {{#iff ../spot.images.length '>' 1}}
                        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    {{/iff}}
                {{/each}}
            </div>
        </div>
        <div class='card mb-3'>
            <div class='card-body'>
                <h5 class='card-title'>{{ capitalizeFirstLetters spot.name }}</h5>
                <p class='card-text'>{{ capitalizeFirstLetter spot.description }}</p>
            </div>
            <div class='card-header'>{{capitalizeFirstLetters spot.location }}</div>
            <ul class='list-group list-group-flush'>
                <li class='list-group-item '>Change Table: {{ spot.hasChangeTable }} </li>
                <li class='list-group-item '>Public Toilet: {{ spot.hasPublicToilet }} </li>
                <li class='list-group-item '>High Chairs: {{ spot.hasHighChairs }} </li>
                <li class='list-group-item '>Kids Menu: {{ spot.hasKidsMenu }} </li>
                <li class='list-group-item '>Toys: {{ spot.hasToys }} </li>
                <li class='list-group-item '>Babyccinos: {{ spot.hasBabyccinos }} </li>
            </ul>
            {{log spot.author.username}}
            <div class='card-footer'>Thanks to {{capitalizeFirstLetters spot.author.username }} for sharing â™¡</div>

            {{#if sessionUser}}
            {{#ifEquals spot.author._id sessionUser._id }}
            <div class='card-body'>
                <a href='/spots/{{ spot._id }}/edit' class='card-link'>Edit</a>
                <form class='d-inline ml-3' action='/spots/{{ spot._id }}/delete?_method=DELETE' method='POST'>
                    <button id="delete" class='card-link'>Delete</button>
                </form>
            </div>
            {{else}}
            {{/ifEquals}}
            {{/if}}
            <div class='card-footer text-muted'>
                Last update : {{ updatedAt }}
            </div>
        </div>
        {{!-- render map (code from mapbox) --}}
        <div class="card mb-3 mx-auto" id='map' style='width: 100%; height: 300px;'></div>
        {{!-- hide from author --}}
        {{#ifNotEqual sessionUser._id spot.author._id}}
        <article class='card mb-3'>
            <div class='card-body'>
                <h4 class='card-title display-6'>
                    Tell us!
                    <small class='text-muted'>Is {{capitalizeFirstLetters spot.name }} cute?</small>
                </h4>
                <div class='card-body'>
                    {{#if sessionUser}}
                    <form action='/spots/{{ spot._id }}/reviews' method='POST' novalidate class='validated_form'>
                        <fieldset class="starability-heart mb-3">
                            <legend>First rating:</legend>
                            <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="0" checked aria-label="No review." />
                            <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                            <label for="first-rate1" title="Terrible">1 star</label>
                            <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                            <label for="first-rate2" title="Not good">2 stars</label>
                            <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                            <label for="first-rate3" title="Average">3 stars</label>
                            <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                            <label for="first-rate4" title="Very good">4 stars</label>
                            <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                            <label for="first-rate5" title="Amazing">5 stars</label>
                        </fieldset>
                        {{!-- <section class='mb-3'>
                            <label for='rating' class='form-label'>Rating</label>
                            <input aria-label='range input for rating' type='range' min='0' max='5' step='1' class='form-range' id='rating' name='review[rating]'>
                        </section> --}}
                        <section class='mb-3'>
                            <label class='form-label' for='body'>Notes</label>
                            <textarea class='form-control' name='review[body]' id='body' cols='30' rows='2' required></textarea>
                            <div class='valid-feedback'>
                            Looks good!
                            </div>
                            <div class='invalid-feedback'>
                            Please add a review.
                            </div>
                        </section>
                        <div>
                            <button class='btn btn-info'>Submit</button>
                        </div>
                    </form>
                    {{else}}
                    <div class='card-body'>
                        <p class='card-text'>You must be logged in to leave a review!</p>
                        <a href='/login' class='card-link btn btn-info '>Login</a>
                    </div>
                    {{/if}}
                </div>
            </div>
        </article>
        {{/ifNotEqual}}
        {{#if spot.reviews}}
            <section class='reviews mb4'>
                <h4 class='display-6 px-2 mt-5 mb-4'>What people are saying :</h4>
                {{#each spot.reviews}}
                <article class='card mb-3'>
                    <section class='card-body'>
                        {{!-- <h5 class='card-title'>Rating : {{ rating }} / 5</h5> --}}
                        <h5 class='card-title '>Rating</h5>
                        <p class="starability-result" data-rating={{rating}}></p>
                        <h6 class="card-subtitle mb-2 text-muted">Author: {{capitalizeFirstLetters author.username}}</h6>
                        <p class='card-text'>Review : {{ body }}</p>
                    </section>
                    {{#if ../sessionUser}}
                    {{#ifEquals author._id ../sessionUser._id}}
                    <div class='card-footer'>
                        <a href='/spots/{{ ../spot._id }}/reviews/{{this._id}}/edit' class='card-link'>Edit</a>
                        <form class='d-inline ml-3' action='/spots/{{ ../spot._id }}/reviews/{{ this._id }}?_method=DELETE' method='POST'>   
                            <button id="delete" class='card-link'>Delete Review</button>
                        </form>
                    </div>   
                    {{else}}
                    {{/ifEquals}}
                    {{/if}}
                </article>
                {{/each}}
            </section>
        {{/if}}
    </div>
</div>
<script>const spot = `{{spot.geometry.coordinates}}`</script>
<script>const spotName = `{{spot.name}}`</script>
<script>const mapToken = `{{map}}`</script>
<script src="/js/spotmap.js"></script>
    